function convertToHours(t,e){var a=Math.floor(t/3600),i=t-3600*a,o=i/60,s=Math.round(o/e)*e/100,n=s.toFixed(2),l=(n+"").split(".");return a+"."+l[1]}var oTable;$(document).ready(function(){$("#utilities_nav").addClass("ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr"),$(".utilities_nav_choices").buttonset();var t=$("div#utilities_panel");$("#reports_button").click(function(){$("#utilities_panel").load("index.php?i=Utilities.php #report_chooser",function(){$('select[name="type"]').chosen(),$('input[name="date_start_display"]').datepicker({dateFormat:"DD, MM d, yy",altField:$('input[name = "date_start"]'),altFormat:"yy-mm-dd"}),$('input[name="date_start_display"]').datepicker("setDate","-7"),$('input[name="date_end_display"]').datepicker({dateFormat:"DD, MM d, yy",altField:$('input[name = "date_end"]'),altFormat:"yy-mm-dd"}),$('input[name="date_end_display"]').datepicker("setDate",new Date),$("#report_chooser").after('<table cellpadding="0" cellspacing="0" border="0" class="display" id="table_reports"><tfoot><tr></tr></tfoot></table>'),$("button.report_submit").live("click",function(t){t.preventDefault();var e=$("#utilities_panel").height()-$("#report_chooser").height()-150;$("#table_reports tfoot th").length&&($("#table_reports").dataTable().fnDestroy(),$("#table_reports tfoot tr").empty()),$("thead th").length&&$("thead th").remove();var a=$('select[name="type"]').val(),i=$('input[name="date_start"]').val(),o=$('input[name="date_end"]').val();$('input[name="detail"]').val();var s=[];-1!==a.indexOf("_grp_")?s.push("grp",a):-1!==a.indexOf("_spv_")?s.push("supvsr_grp",a):-1!==a.indexOf("_cse_")?s.push("case",a):s.push("user",a),$.ajax({url:"lib/php/data/utilities_reports_load.php?type="+s[0]+"&columns_only=true",dataType:"json",type:"get",error:function(){return!0},success:function(t){if(t){for(var a=0;t.aoColumns.length>a;a++)$("#table_reports tfoot tr").append("<th></th>");oTable=$("#table_reports").dataTable({sAjaxSource:"lib/php/data/utilities_reports_load.php?type="+s[0]+"&val="+s[1]+"&date_start="+i+"&date_end="+o,aoColumns:t.aoColumns,bAutoWidth:!1,bProcessing:!0,bDestroy:!0,bScrollInfinite:!0,sScrollY:e,iDisplayLength:150,bSortCellsTop:!0,oLanguage:{sEmptyTable:"No data found."},oTableTools:{sSwfPath:"lib/DataTables-1.8.2/extras/TableTools/media/swf/copy_cvs_xls_pdf.swf",aButtons:[{sExtends:"collection",sButtonText:"Print/Export",aButtons:[{sExtends:"copy",mColumns:"visible"},{sExtends:"csv",mColumns:"visible"},{sExtends:"xls",mColumns:"visible"},{sExtends:"pdf",mColumns:"visible",sTitle:"Report",bFooter:"visible"},{sExtends:"print",mColumns:"visible"}]}]},sDom:"frTt",fnInitComplete:function(){$("#table_reports").addClass("print_content"),$("#ToolTables_table_reports_5").live("click",function(){var t=$('<div class="dialog-casenote-delete" title="Print">Please use your browser\'s print function to print this table.Press escape when finished.</div>').dialog({autoOpen:!1,resizable:!1,modal:!0,buttons:{OK:function(){$(this).dialog("destroy")}}});$(t).dialog("open")})},fnFooterCallback:function(t,e){if(e.length>0){for(var a=0,i=oTable.fnGetColumnIndex("Seconds"),o=0;e.length>o;o++)a+=parseFloat(e[o][i]);var s=t.getElementsByTagName("th"),n=i-2;s[n].innerHTML="Total Hours";var l=$("#utilities_panel").attr("data-unit");s[i-1].innerHTML=convertToHours(a,l)}}})}}})})})}),$("#config_button").click(function(){t.load("lib/php/data/utilities_configuration_load.php")}),$("#non_case_button").click(function(){$("#utilities_panel").html('<div id="noncase_panel"></div>'),loadCaseNotes($("#noncase_panel"),"NC")}),$("#reports_button").trigger("click")}),$("a.config_item_link").live("click",function(t){t.preventDefault(),$(this).hasClass("closed")?$(this).removeClass("closed").addClass("opened"):$(this).removeClass("opened").addClass("closed"),$("div.config_item > a").not($(this)).removeClass("opened").addClass("closed"),$(this).next().toggle(),$("form.config_form").not($(this).next()).hide()}),$("a.change_config").live("click",function(t){t.preventDefault();var e=$(this).closest("form"),a=$(this).closest("div.config_item"),i=$(this).closest("div").attr("id");$(this).hasClass("add")||$(this).parent().remove();var o=e.serializeArray();o.push({name:"type",value:e.attr("data-type")}),$.post("lib/php/data/utilities_configuration_process.php",o,function(t){var e=$.parseJSON(t);e.error===!0?notify(e.message,!0):(notify(e.message),a.load("lib/php/data/utilities_configuration_load.php #"+i,function(){$(this).find("form").show()}))})});