$(document).ready(function(){$("#home_nav").addClass("ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr"),$(".home_nav_choices").buttonset(),$("button#quick_add").button({icons:{primary:"fff-icon-add"},text:!0}).click(function(){$("#quick_add_form").dialog("open")});var e=$("div#home_panel");$("#activity_button").click(function(){setInterval(function(){$.ajax({url:"lib/php/data/home_activities_load.php",success:function(t){e.html(t),e.find("hr").last().remove()},dataType:"html"})},9e4);var t=function(e){e.load("lib/php/data/home_activities_load.php",function(){$("a.doc_view").live("click",function(e){e.preventDefault();var t=$(this).attr("data-id");if($(this).hasClass("url"))$.post("lib/php/data/cases_documents_process.php",{action:"open",item_id:t,doc_type:"document"},function(e){var t=$.parseJSON(e);window.open(t.target_url,"_blank")});else if($(this).hasClass("ccd")){var a=$(this).closest("p").prev("p").find("a").attr("href");window.location.href=a}else $(this).hasClass("pdf")?Object.create?($("#pdf-viewer").show(),$("#frme").attr("src","lib/javascripts/pdfjs/web/viewer.html?item_id="+t),$("#pdf-viewer").click(function(){$("#frme").attr("src",""),$(this).hide()}),$("body").bind("keyup.pdfViewer",function(e){27===e.keyCode&&($("#frme").attr("src",""),$("#pdf-viewer").hide())})):$.download("lib/php/data/cases_documents_process.php",{item_id:t,action:"open"}):$.download("lib/php/data/cases_documents_process.php",{item_id:t,action:"open",doc_type:"document"})}),e.find("hr").last().remove()})};t(e)}),$("#upcoming_button").click(function(){clearInterval(window.activitiesRefresh),e.load("html/templates/interior/home_upcoming.php",function(){$("#calendar").fullCalendar({theme:!0,aspectRatio:2,header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},eventSources:["lib/php/data/home_events_load.php"],viewDisplay:function(){1>$("img.ical").length&&$("span.fc-button-month").before('<a href="feeds/ical.php?key='+$("#home_nav").attr("data-key")+'" target="_new"><img class="ical" title="Your iCal feed" src="html/ico/ical.png"></a>')},dayClick:function(e){$("#quick_add").trigger("click"),$("#quick_add_nav a:eq(1)").trigger("click"),$("#ev_start").datetimepicker("setDate",e)},eventClick:function(e){e.allDay=e.allDay===!1?"":"Yes",null===e.end&&(e.end="");var t=null;t="NC"!==e.caseId?'<p><label>Case:</label> <a href="index.php?i=Cases.php#cases/"'+e.caseId+'">'+e.caseName+"</a></p>":"",$("div#event_detail_window").html('<a class="event_detail_close" href="#"><img src="html/ico/cross.png" border=0 title="Close"></a><h3>" + event.shortTitle + "</h3><div id = "event_users_display"></div><hr /><p><label>Start:</label> " + event.start + "</p><p><label>End: </label> " + event.end + "</p><p><label>All Day:</label>'+e.allDay+"</p><p><label>Where: </label>"+e.where+"</p>"+t+"<p id ="+'"event_detail_desc"><label>Description: </label>" + event.description + "</p>"').dialog("open"),e.canDelete===!0&&$("p#event_detail_desc").after('<br /><br /><p><a href = "#" class="event_detail_delete" data-id="'+e.id+'">Delete</a></p>'),e.largeGroup===!0&&$("div#event_users_display").css({height:"90px","overflow-y":"scroll"}),$(e.users).each(function(){var e=null,t=this;$.ajax({url:"people/tn_"+t.user_id+".jpg",type:"HEAD",error:function(){e="people/tn_no_picture.png";var a='<img src="'+e+'" title="'+t.full_name+'" alt="'+t.full_name+'">';$("div#event_users_display").append(a)},success:function(){e="people/tn_"+t.user_id+".jpg";var a='<img src="'+e+'" title="'+t.full_name+'" alt="'+t.full_name+'">';$("div#event_users_display").append(a)}})}),$("a.event_detail_delete").live("click",function(e){e.preventDefault();var t=$(this).attr("data-id"),a=$('<div class="dialog-casenote-delete" title="Delete this Event?">This event will be permanently deleted.  Are you sure?</div>').dialog({autoOpen:!1,resizable:!1,modal:!0,buttons:{Yes:function(){$.post("lib/php/data/cases_events_process.php",{action:"delete",event_id:t},function(e){var a=$.parseJSON(e);a.error===!0?notify(a.message,!0):(notify(a.message),$("#calendar").fullCalendar("removeEvents",t),$("a.event_detail_close").trigger("click"))}),$(this).dialog("destroy")},No:function(){$(this).dialog("destroy")}}});$(a).dialog("open")})}})})}),$("#trends_button").click(function(){clearInterval(window.activitiesRefresh),e.html("<p>Trends is a new feature which shows you real-time stats aboutthe work you and your group are doing.  Coming soon!</p>")}),$("#activity_button").trigger("click").next("label").addClass("ui-state-active");var t=$("button#quick_add").offset().left-175,a=$("button#quick_add").offset().top+40;$("#quick_add_form").dialog({autoOpen:!1,height:520,width:325,modal:!0,position:[t,a]}).siblings(".ui-dialog-titlebar").remove(),$("div#event_detail_window").dialog({autoOpen:!1,height:400,width:500,modal:!0}).siblings(".ui-dialog-titlebar").remove(),$("#quick_add_form a.toggle").click(function(e){return e.preventDefault(),$(this).hasClass("active")?!1:($(this).addClass("active"),$(this).siblings("a.toggle").removeClass("active"),$("div.toggle_form").toggle(),void 0)}),$("#cn_date").datepicker(),$("#cn_date").datepicker("setDate",new Date),$("#ev_start").datetimepicker({ampm:!0,stepHours:1,stepMinute:5,hour:9,minute:0,onSelect:function(e){$("#ev_end").datetimepicker("setDate",e)}}),$("#ev_end").datetimepicker({ampm:!0,stepHours:1,stepMinute:5,hour:10,minute:0}),$("select#cn_case").chosen(),$("select#ev_case").chosen(),$("select#ev_users").chosen(),$("button#quick_add_cn_submit").button({icons:{primary:"fff-icon-add"},text:!0}).click(function(t){t.preventDefault();var a=$(this).closest('form[name="quick_cn"]').serializeArray(),i=validQuickCaseNote(a);return i.length?($(this).closest("p").siblings("p.error").html(i),!1):($.post("lib/php/data/cases_casenotes_process.php",a,function(t){var a=$.parseJSON(t);return a.error===!0?($(this).closest("p").siblings("p.error").html(a.message),!1):(notify(a.message),$("input#activity_button").next().hasClass("ui-state-active")&&activitiesLoad(e),$("a.quick_add_close").trigger("click"),void 0)}),void 0)}),$("button#quick_add_ev_submit").button({icons:{primary:"fff-icon-add"},text:!0}).click(function(e){e.preventDefault();var t=$('form[name="quick_event"]'),a=t.not('select[name="responsibles"]').serializeArray(),i=t.find('select[name="responsibles"]').val(),n=$.extend({},i);a.unshift(n);var s=validEvent(a);if(s.length)return $(this).closest("p").siblings("p.error").html(s),!1;var l=null;l=t.find('input[name = "all_day"]').is(":checked")?"on":"off",$.post("lib/php/data/cases_events_process.php",{task:t.find('input[name = "task"]').val(),where:t.find('input[name = "where"]').val(),start:t.find('input[name = "start"]').val(),end:t.find('input[name = "end"]').val(),all_day:l,notes:t.find('textarea[name = "notes"]').val(),responsibles:i,action:"add",case_id:t.find('select[name = "case_id"]').val()},function(e){var a=$.parseJSON(e);return a.error===!0?($(this).closest("p").siblings("p.error").html(a.message),!1):(notify(a.message),$("input#upcoming_button").next().hasClass("ui-state-active")&&$("#calendar").fullCalendar("refetchEvents"),$("a.quick_add_close").trigger("click"),t[0].reset,$("#ev_users").trigger("liszt:updated"),void 0)})}),$("a.quick_add_close").click(function(e){e.preventDefault(),$("#quick_add_form form").each(function(){this.reset()}).find("p.error").html(""),$("#cn_date").datepicker("setDate",new Date),$("#ev_start").datetimepicker("setDate",""),$("select#cn_case").val("NC"),$("input.ui-autocomplete-input").val($("select#cn_case option:selected").text()),$("#quick_add_form").dialog("close")}),$("a.event_detail_close").live("click",function(e){e.preventDefault(),$("#event_detail_window").dialog("close")})});