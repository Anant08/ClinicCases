var oTable,aoColumns;$(document).ready(function(){function e(){var e=oTable.fnSettings();for(iCol=0;e.aoPreSearchCols.length>iCol;iCol++)e.aoPreSearchCols[iCol].sSearch="";oTable.fnFilter(""),ColReorder.fnReset(oTable),$("input").each(function(){this.value=""}),$("select").each(function(){this.selectedIndex="0"}),$("#addOpenRow, #addCloseRow").each(function(){$(this).text("Add Condition")}),$("#second_open_cell, #second_close_cell").css({visibility:"hidden"}),$("thead tr.advanced_2").hide("slow"),oTable.fnFilter("^$",oTable.fnGetColumnIndex("Date Close"),!0,!1),t="open",oTable.fnSort([[oTable.fnGetColumnIndex("Last Name"),"asc"]]),oTable.fnDraw()}var t="open";$.ajax({url:"lib/php/data/cases_columns_load.php",dataType:"json",error:function(){return alert("Sorry, there is an error in your ClinicCases configuration"),!0},success:function(s){s&&(aoColumns=s.aoColumns,oTable=$("#table_cases").dataTable({bJQueryUI:!0,bProcessing:!0,bScrollInfinite:!0,bScrollCollapse:!0,bSortCellsTop:!0,bStateSave:!0,iCookieDuration:31536e3,sScrollY:adjustedHeight-95,iDisplayLength:50,aaSorting:[[4,"asc"]],aoColumns:aoColumns,sDom:"R<'H'fTCi>rt",oColVis:{aiExclude:[0,6,7],bRestore:!0,buttonText:"Columns",fnStateChange:function(e){$("div.dataTables_scrollHeadInner thead th.addSelects:empty").each(function(){this.innerHTML=fnCreateSelect(oTable.fnGetColumnData(e,!0,!1,!0))})}},oTableTools:{sSwfPath:"lib/DataTables-1.8.2/extras/TableTools/media/swf/copy_cvs_xls_pdf.swf",aButtons:[{sExtends:"collection",sButtonText:"Print/Export",aButtons:[{sExtends:"copy",mColumns:"visible"},{sExtends:"csv",mColumns:"visible"},{sExtends:"xls",mColumns:"visible"},{sExtends:"pdf",mColumns:"visible"},{sExtends:"print",mColumns:"visible"}]},{sExtends:"text",sButtonText:"Reset",sButtonClass:"DTTT_button_reset",sButtonClassHover:"DTTT_button_reset_hover"},{sExtends:"text",sButtonText:"New Case",sButtonClass:"DTTT_button_new_case",sButtonClassHover:"DTTT_button_new_case_hover"}]},sAjaxSource:"lib/php/data/cases_load.php",bDeferRender:!0,fnInitComplete:function(){oTable.fnFilter("^$",oTable.fnGetColumnIndex("Date Close"),!0,!1),$(window).bind("resize",function(){oTable.fnDraw(!1),oTable.fnAdjustColumnSizing()}),$("div.dataTables_scrollHeadInner thead th.addSelects").each(function(){var e=oTable.fnGetColumnIndex($(this).attr("name"));this.innerHTML=fnCreateSelect(oTable.fnGetColumnData(e,!0,!1,!0))}),$("div.dataTables_filter").append('<select id="chooser"><option value="open" selected=selected>Open Cases Only</option><option value="closed">Closed Cases Only</option><option value="all">All Cases</option></select>  <a href="#" id="set_advanced">Advanced Search</a>'),$("div.ColVis button").removeClass().addClass("DTTT_button DTTT_button_collection ui-button ui-state-default"),$("#ToolTables_table_cases_6").click(function(){e()}),$("#table_cases").hasClass("can_add")?$("#ToolTables_table_cases_7").click(function(){$.post("lib/php/utilities/create_new_case.php",function(e){var t=$.parseJSON(e);if(t.error===!0)notify(t.message,!0);else{var s=t.newId;callCaseWindow(s,!0)}})}):$("#ToolTables_table_cases_7").remove(),$("#chooser").live("change",function(){switch($(this).val()){case"all":t="open and closed",oTable.fnFilter("",oTable.fnGetColumnIndex("Date Close"));break;case"open":t="open",oTable.fnFilter("^$",oTable.fnGetColumnIndex("Date Close"),!0,!1);break;case"closed":t="closed",oTable.fnFilter("^.+$",oTable.fnGetColumnIndex("Date Close"),!0,!1)}}),$("#set_advanced").live("click",function(e){e.preventDefault(),"none"!==$("tr.advanced, tr.advanced_2").css("display")?$("tr.advanced, tr.advanced_2").css({display:"none"}):($("th.ui-state-default").css({"border-bottom":"0px"}),$(".complex").children().css({display:"inline","margin-bottom":"0px"}),$("#open_range , #close_range").css({"margin-top":"18px"}),$("thead tr.advanced").toggle("slow"),$("#second_open_cell, #second_close_cell").css({visibility:"hidden"}),oTable.fnFilter("",oTable.fnGetColumnIndex("Date Close"),!0,!1),$("#chooser").val("all"),t="open and closed"),oTable.fnDraw()}),$("#addopenRow").click(function(e){e.preventDefault(),"visible"===$("#second_open_cell").css("visibility")?($(this).text("Add Condition"),$("#second_open_cell").css({visibility:"hidden"}),$("thead tr.advanced_2").hide("slow")):($(this).text("AND IS"),$("#second_open_cell").css({visibility:"visible"}),$("#date_open_2 , #date_close_2").css({width:"60%"}),$("thead tr.advanced_2").show("slow"))}),$("#addcloseRow").click(function(e){e.preventDefault(),"visible"===$("#second_close_cell").css("visibility")?($(this).text("Add Condition"),$("#second_close_cell").css({visibility:"hidden"}),$("thead tr.advanced_2").hide("slow")):($(this).text("AND IS"),$("#second_close_cell").css({visibility:"visible"}),$("#date_open_2 , #date_close_2").css({width:"60%"}),$("thead tr.advanced_2").show("slow"))}),$("thead input").live("keyup",function(){var e=$(this).attr("name"),t=oTable.fnGetColumnIndex(e);oTable.fnFilter(this.value,t)}),$("div.dataTables_scrollHeadInner tr.advanced th.addSelects select").live("change",function(){var e=$(this).parent(),t=oTable.fnGetColumnIndex(e.attr("name")),s=this.value,n="^"+s+"$";oTable.fnFilter(n,t,!0,!1,!1)}),$(function(){$("#date_open , #date_close, #date_open_2, #date_close_2").datepicker({changeMonth:!0,changeYear:!0,onSelect:function(){$(this).css({color:"black"}),oTable.fnDraw()}})}),$("#open_range, #open_range_2, #close_range, #close_range_2").live("change",function(){oTable.fnDraw()}),$("#table_cases tbody").click(function(e){var t=oTable.fnGetPosition(e.target.parentNode),s=oTable.fnGetData(t),n=s[0];callCaseWindow(n)}),$("#table_cases").addClass("print_content"),$("tr.advanced, tr.advanced_2").addClass("print_content_no"),$("#ToolTables_table_cases_5").live("click",function(){var e=$('<div class="dialog-casenote-delete" title="Print">Please use your browser\'s print function to print this table. Press escape when finished.</div>').dialog({autoOpen:!1,resizable:!1,modal:!0,buttons:{OK:function(){$(this).dialog("destroy")}}});$(e).dialog("open")}),$("#processing").hide()},oLanguage:{sInfo:'Found <b>_TOTAL_</b> <span id="caseStatus"></span> cases',sInfoFiltered:"from a total of <b>_MAX_</b> cases",sEmptyTable:"No cases found.",sZeroRecords:"No cases found."},fnDrawCallback:function(){$("#caseStatus").text(t),$(".hasDatepicker").css({width:"60%"}),$(".complex").css({"min-width":"160px"})}}),router())}})}),$.fn.dataTableExt.afnFiltering.push(function(e,t){var s=document.getElementById("open_range").value,n=document.getElementById("open_range_2").value,a=document.getElementById("close_range").value,l=document.getElementById("close_range_2").value,o=document.getElementById("date_open").value,i=document.getElementById("date_open_2").value,r=document.getElementById("date_close").value,c=document.getElementById("date_close_2").value,d=t[6],u=t[7],b=o.substring(6,10)+o.substring(0,2)+o.substring(3,5),f=i.substring(6,10)+i.substring(0,2)+i.substring(3,5),_=r.substring(6,10)+r.substring(0,2)+r.substring(3,5),p=c.substring(6,10)+c.substring(0,2)+c.substring(3,5),h=d.substring(6,10)+d.substring(0,2)+d.substring(3,5),v=u.substring(6,10)+u.substring(0,2)+u.substring(3,5);if(""===b&&""===_)return!0;if(""!==b&&""===_&&""===f&&""===p){if("equals"===s&&h===b)return!0;if("less"===s&&b>h)return!0;if("greater"===s&&h>b)return!0}if(""===b&&""!==_&&""===f&&""===p){if("equals"===a&&v===_)return!0;if("less"===a&&_>v)return!0;if("greater"===a&&v>_)return!0}if(""!==b&&""!==_&&""===f&&""===p){if("equals"===s&&"equals"===a&&h===b&&v===_)return!0;if("greater"===s&&"less"===a&&h>b&&_>v)return!0;if("less"===s&&"greater"===a&&b>h&&v>_)return!0}if(""!==b&&""===_&&""!==f&&""===p){if("equals"===s&&"equals"===n&&h===b&&h===f)return!0;if("greater"===s&&"less"===n&&h>b&&f>h)return!0;if("less"===s&&"greater"===n&&b>h&&h>f)return!0}if(""===b&&""!==_&&""===f&&""!==p){if("equals"===a&&"equals"===l&&v===_&&v===p)return!0;if("greater"===a&&"less"===l&&v>_&&p>v)return!0;if("less"===a&&"greater"===l&&_>v&&v>p)return!0}if(""!==b&&""!==_&&""!==f&&""!==p){if("equals"===s&&"equals"===n&&"equals"===a&&"equals"===n&&h===b&&h===f&&v===_&&v===p)return!0;if("greater"===s&&"less"===n&&"greater"===a&&"less"===n&&h>b&&f>h&&v>_&&p>v)return!0}if(""!==b&&""!==_&&""!==f&&""===p){if("greater"===s&&"less"===n&&"equals"===a&&h>b&&f>h&&v===_)return!0;if("greater"===s&&"less"===n&&"greater"===a&&h>b&&f>h&&v>_)return!0;if("greater"===s&&"less"===n&&"less"===a&&h>b&&f>h&&_>v)return!0}if(""!==b&&""!==_&&""===f&&""!==p){if("greater"===a&&"less"===l&&"equals"===s&&v>_&&p>v&&h===b)return!0;if("greater"===a&&"less"===l&&"greater"===s&&v>_&&p>v&&h>b)return!0;if("greater"===a&&"less"===l&&"less"===s&&v>_&&p>v&&b>h)return!0}return!1});